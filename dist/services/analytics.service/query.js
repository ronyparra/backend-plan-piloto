"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;
var query = {
  general: "SELECT \n\tjson_build_object(\n\t\t'moneda', moneda.abreviatura,\n\t\t'saldo',SUM(precio*cantidad)\n\t) as rows\n    FROM actividad\n    JOIN actividad_concepto_detalle USING (idactividad)\n    JOIN moneda USING (idmoneda)\n    WHERE fecha BETWEEN $1::date AND  $2::date\n    GROUP BY moneda.abreviatura;",
  estado: function estado(condicion) {
    return "\n    SELECT \n    json_build_object(\n        'moneda', moneda.abreviatura,\n        'saldo', ROUND(SUM(cantidad*precio))\n    ) as rows\n    FROM \tactividad\n    JOIN \tactividad_concepto_detalle USING (idactividad)\n    JOIN \tmoneda USING (idmoneda)\n    WHERE \tfecha BETWEEN $1::date AND  $2::date\n    AND\t\tidestadocobro ".concat(condicion, " $3\n    GROUP BY moneda.abreviatura;\n  ");
  },
  pendiente: "SELECT\n\tjson_build_object(\n\t\t'tipo',tp.descripcion,\n\t\t'registrado', COUNT(idpendiente) FILTER (WHERE \tfecha BETWEEN $1::date AND  $2::date),\n\t\t'terminado', COUNT(idpendiente) FILTER (WHERE activo = false AND fecha BETWEEN $1::date AND  $2::date)\n\t) as rows\n  FROM \t\tpendiente \n  FULL JOIN\ttipo_pendiente AS tp USING(idtipo_pendiente)\n  GROUP BY \ttp.descripcion",
  cliente: "SELECT \n  json_build_object(\n    'idcliente',idcliente,\n    'cliente', razonsocial,\n    'cantidad',(SELECT COUNT(a.idactividad) FROM actividad AS a WHERE a.idcliente =  actividad.idcliente),\n    'guarani',  SUM(precio*cantidad) FILTER (WHERE (idmoneda = 1)) ,\n    'dolar',SUM(precio*cantidad)  FILTER (WHERE (idmoneda = 2))\n  ) as rows\n  FROM actividad\n    JOIN cliente USING (idcliente)\n    JOIN actividad_concepto_detalle USING (idactividad)\n    WHERE \tfecha BETWEEN $1::date AND  $2::date\n  GROUP BY idcliente, razonsocial\n  ",
  concepto: "SELECT\n  json_build_object(\n      'idconcepto',concepto.idconcepto,\n      'concepto',concepto.descripcion,\n      'cantidad',SUM(acd.cantidad),\n      'guarani',SUM(acd.precio*acd.cantidad) FILTER (WHERE (acd.idmoneda = 1)),\n      'dolar',SUM(acd.precio*acd.cantidad) FILTER (WHERE (acd.idmoneda = 2))\n  ) as rows\n  FROM actividad\n  JOIN actividad_concepto_detalle AS acd USING (idactividad)\n  JOIN concepto ON concepto.idconcepto = acd.idconcepto\n  WHERE \tfecha BETWEEN $1::date AND  $2::date\n  GROUP BY concepto.idconcepto, concepto.descripcion",
  tecnico: "\n  WITH saldo_usuario AS (\n    WITH count_usuario(cantidad) AS (\n      SELECT \n        COUNT(idusuario) as cantidad,\n        idactividad\n      FROM actividad_tecnico_detalle \n      GROUP BY idactividad\n      ), saldo_guarani (saldo) AS(\n\t\tSELECT \n        SUM(acd.precio * cantidad) as saldo,\n        idactividad\n      \tFROM actividad_concepto_detalle AS acd \n\t  \tJOIN concepto USING (idconcepto)\n      \tWHERE acd.idmoneda = 1\n\t  \tAND idcategoria = 1\n      \tGROUP BY idactividad\n      ), saldo_dolar (saldo) AS(\n\t\tSELECT \n \t\tSUM(acd.precio * cantidad) as saldo,\n  \t\tidactividad\n\t\tFROM actividad_concepto_detalle AS acd\n\t\tJOIN concepto USING (idconcepto)\n\t\tWHERE acd.idmoneda = 2\n\t\tAND\tconcepto.idcategoria = 1\n\t\tGROUP BY idactividad\n      )\n      SELECT \n      atd.idusuario,\n      (SELECT saldo \n         FROM saldo_guarani\n         WHERE idactividad = atd.idactividad) / \n        (SELECT cantidad \n         FROM count_usuario \n         WHERE idactividad = atd.idactividad) as guarani,\n      (SELECT saldo \n         FROM saldo_dolar\n         WHERE idactividad = atd.idactividad) / \n        (SELECT cantidad \n         FROM count_usuario \n         WHERE idactividad = atd.idactividad) as dolar\n       \n      FROM actividad_tecnico_detalle AS atd\n      JOIN actividad USING(idactividad)\n      WHERE \tfecha BETWEEN $1::date AND  $2::date\n      GROUP BY  atd.idactividad, atd.idusuario\t\n    ) \n      SELECT\n        json_build_object(\n          'id',idusuario,\n          'descripcion',CONCAT(nombre, ' ',apellido),\n          'cantidad',(SELECT COUNT(idusuario) FROM saldo_usuario WHERE idusuario = usuario.idusuario),\n          'guarani',(SELECT SUM(guarani) FROM saldo_usuario WHERE idusuario = usuario.idusuario),\n          'dolar',(SELECT SUM(dolar) FROM saldo_usuario WHERE idusuario = usuario.idusuario)\n        ) AS rows\n      FROM usuario    \n  ",
  categoria: "\n  SELECT \n\tjson_build_object(\n\t\t'id',categoria.idcategoria,\n\t\t'descripcion',categoria.descripcion,\n\t\t'cantidad',COUNT(acd.idconcepto),\n\t\t'guarani',SUM(acd.precio * acd.cantidad) FILTER (WHERE acd.idmoneda = 1),\n\t\t'dolar',SUM(acd.precio * acd.cantidad) FILTER (WHERE acd.idmoneda = 2)\n\t) AS rows\n  FROM actividad\n  JOIN actividad_concepto_detalle AS acd USING(idactividad)\n  JOIN concepto USING (idconcepto)\n  JOIN categoria USING (idcategoria)\n  WHERE \tfecha BETWEEN $1::date AND  $2::date\n  GROUP BY categoria.idcategoria,categoria.descripcion\n  ",
  cobro: "\n  SELECT \t\n\tjson_build_object(\n\t\t'id', \t\t\tidusuariocobro,\n    'cantidad',\t\tCOUNT(idcliente_cobro),\n\t\t'descripcion', \tCONCAT(usuario.nombre,' ',usuario.apellido),\n\t\t'guarani',\t\tSUM(saldocobrado) FILTER (WHERE idmoneda = 1),\n\t\t'rguarani',\t\tSUM((SELECT * FROM calcularRetencion(retencion,saldoacobrar) WHERE idmoneda =1)),\n\t\t'dolar',\t\tSUM(saldocobrado) FILTER (WHERE idmoneda = 2),\n\t\t'rdolar', \t\tSUM((SELECT * FROM calcularRetencion(retencion,saldoacobrar)WHERE idmoneda =2))\n\t) as rows\n  FROM cliente_cobro \n  JOIN moneda USING (idmoneda)\n  JOIN usuario ON usuario.idusuario = idusuariocobro\n  AND fechacobro BETWEEN $1::date AND $2::date\n  GROUP BY usuario.nombre, usuario.apellido, idusuariocobro;\n  ",
  estados: function estados(old) {
    return "\n  WITH saldoestado  AS (\n\t  SELECT \n\t\t  \tidestadocobro,\n\t\t\t  moneda.idmoneda,\n\t\t\t  SUM(precio*cantidad) AS saldo\n\t  FROM \tactividad\n\t  JOIN \tactividad_concepto_detalle USING (idactividad)\n\t  JOIN \tmoneda USING (idmoneda)\n    ".concat(old ? 'WHERE 	fecha <  $2::date' : 'WHERE 	fecha BETWEEN $1::date AND  $2::date', "\n  \tGROUP BY moneda.abreviatura, moneda.idmoneda, idestadocobro\n  ), saldocobrado  AS (\n\t  SELECT \n\t\t\tidestadocobro,\n\t\t\tmoneda.idmoneda,\n\t\t\tSUM(precio*cantidad) AS saldo\n\tFROM \tactividad\n\tJOIN \tactividad_concepto_detalle USING (idactividad)\n\tJOIN \tmoneda USING (idmoneda)\n\tWHERE \tfecha BETWEEN $1::date AND  $2::date\n\tGROUP BY moneda.abreviatura, moneda.idmoneda, idestadocobro\n  )\n  SELECT * FROM (\n\tSELECT \n\t\tjson_build_object(\n        ").concat(old ? "'mensaje', '(Con Anteriores)'," : "", "\n        'id', estadocobro.idestadocobro,\n  \t\t\t'descripcion', \t\testadocobro.descripcion,\n  \t\t\t'guarani',\t(SELECT \tsaldo \n\t\t \t\t\tFROM \t\tsaldoestado \n\t\t \t\t\tWHERE \t\tidestadocobro = estadocobro.idestadocobro \n\t\t \t\t\tAND \t\tidmoneda = 1),\n  \t\t\t'dolar',\t(SELECT \tsaldo \n\t\t\t \t\tFROM \t\tsaldoestado \n\t\t \t\t\tWHERE \t\tidestadocobro = estadocobro.idestadocobro \n\t\t \t\t\tAND \t\tidmoneda = 2)\n\t\t) AS rows\n\tFROM estadocobro WHERE idestadocobro != 3\n\tUNION ALL\n\tSELECT \n\t\tjson_build_object(\n        ").concat(old ? "'mensaje', '(Actual)'," : "", "\n        'id', estadocobro.idestadocobro,\n  \t\t\t'descripcion',  \testadocobro.descripcion,\n  \t\t\t'guarani',\t(SELECT \tsaldo \n\t\t\t\t\tFROM \t\tsaldocobrado \n\t\t\t\t\tWHERE \t\tidestadocobro = estadocobro.idestadocobro \n\t\t\t\t\tAND \t\tidmoneda = 1),\n  \t\t\t'dolar',\t(SELECT \tsaldo \n\t\t \t\t\tFROM \t\tsaldocobrado \n\t\t \t\t\tWHERE \t\tidestadocobro = estadocobro.idestadocobro \n\t\t \t\t\tAND \t\tidmoneda = 2)\n\t\t) AS rows\n\tFROM estadocobro WHERE idestadocobro = 3\n  ) AS estados\n  ");
  }
};
var _default = query;
exports["default"] = _default;